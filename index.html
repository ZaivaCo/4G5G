<!DOCTYPE html>
<html>
<head>
    <title>åŸºç«™å»ºè®¾æ¨¡æ‹Ÿå™¨</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: #f0f4f8;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        h1 {
            color: #2c3e50;
            margin: 20px 0;
        }
        #canvas {
            width: 1000px; /* ä¿®æ”¹å®½åº¦ */
            height: 700px; /* ä¿®æ”¹é«˜åº¦ */
            border: 2px solid #333;
            position: relative;
            background: white;
            margin: 20px;
        }
        .user {
            position: absolute;
            font-size: 40px;
            transform: translate(-50%, -50%);
            transition: all 0.1s;
        }
        .base-station {
            position: absolute;
            font-size: 48px;
            transform: translate(-50%, -50%);
        }
        .station-label {
            position: absolute;
            font-size: 12px;
            text-align: center;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 2px 8px;
            border-radius: 3px;
            transform: translateX(-50%);
        }
        #controls {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: 0.3s;
        }
        #add4G {
            background: #4CAF50;
            color: white;
        }
        #add5G {
            background: #2196F3;
            color: white;
        }
        #resetButton {
            background: #E74C3C;
            color: white;
        }
        #status {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .signal-bar {
            width: 200px;
            height: 10px;
            border-radius: 5px;
            margin-top: 10px;
            background: linear-gradient(90deg, #e74c3c, #f1c40f, #2ecc71);
        }
        #counter {
            position: fixed;
            top: 20px;
            left: 20px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        #musicControl {
            position: fixed;
            bottom: 20px;
            left: 20px;
            padding: 10px 20px;
            background: #3498db;
            color: white;
            border-radius: 25px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }
    </style>
</head>
<body>
    <h1>åŸºç«™å»ºè®¾æ¨¡æ‹Ÿå™¨</h1>
    <div id="canvas">
        <!-- åˆå§‹åŒæ¨¡åŸºç«™ -->
        <div class="base-station" style="left: 500px; top: 350px">ğŸ“¡</div>
        <div class="station-label" style="left: 500px; top: 390px">åŒæ¨¡åŸºç«™</div>
        <div id="user" class="user">ğŸ˜€</div>
    </div>

    <div id="status">
        <div>4Gé€Ÿç‡ï¼š<span id="4g">0</span> Mbps</div>
        <div>5Gé€Ÿç‡ï¼š<span id="5g">0</span> Mbps</div>
        <div class="signal-bar" id="signalBar"></div>
    </div>

    <div id="counter">
        <div>4GåŸºç«™ï¼š<span id="4gCount">1</span></div> <!-- åˆå§‹å€¼æ”¹ä¸º1 -->
        <div>5GåŸºç«™ï¼š<span id="5gCount">1</span></div> <!-- åˆå§‹å€¼æ”¹ä¸º1 -->
        <div>æ€»åŸºç«™ï¼š<span id="totalCount">1</span></div> <!-- åˆå§‹å€¼æ”¹ä¸º1 -->
    </div>

    <div id="controls">
        <button id="add4G">æ–°å»º4GåŸºç«™</button>
        <button id="add5G">æ–°å»º5GåŸºç«™</button>
        <button id="resetButton">é‡ç½®</button> <!-- æ–°å¢é‡ç½®æŒ‰é’® -->
    </div>

    <div id="musicControl" onclick="toggleAudio()">ğŸµ å¼€å¯éŸ³æ•ˆ</div>

    <audio id="bgm" loop>
        <source src="music.mp3" type="audio/mpeg">
    </audio>

    <script>
        const canvas = document.getElementById('canvas');
        const user = document.getElementById('user');
        const bgm = document.getElementById('bgm');
        let stations = [{x: 500, y: 350, type: 'dual'}]; // åˆå§‹åŒæ¨¡åŸºç«™
        let isAudioEnabled = false;
        const BASE_VOLUME = 0.6;
        const SIGNAL = {
            '4G': { max: 100, range: 300 },   // 4Gå³°å€¼100Mbps
            '5G': { max: 1000, range: 150 }   // 5Gå³°å€¼1000Mbps
        };

        // åˆå§‹åŒ–ç”¨æˆ·ä½ç½®
        let userX = 500, userY = 350;
        updateUserPosition();

        function updateUserPosition() {
            user.style.left = userX + 'px';
            user.style.top = userY + 'px';
        }

        function createStation(type) {
            const station = document.createElement('div');
            station.className = 'base-station';
            station.style.left = userX + 'px';
            station.style.top = userY + 'px';
            station.innerHTML = 'ğŸ“¡';

            const label = document.createElement('div');
            label.className = 'station-label';
            label.textContent = type + 'åŸºç«™';
            label.style.left = userX + 'px';
            label.style.top = userY + 40 + 'px';

            canvas.appendChild(station);
            canvas.appendChild(label);
            stations.push({x: userX, y: userY, type});
            
            updateCounter();
            updateSignal();
        }

        function updateCounter() {
            const count4G = stations.filter(s => s.type === '4G' || s.type === 'dual').length;
            const count5G = stations.filter(s => s.type === '5G' || s.type === 'dual').length;
            const totalCount = stations.length;

            // åŒæ¨¡åŸºç«™ä»…ç®—ä½œä¸€ä¸ªæ€»åŸºç«™
            document.getElementById('4gCount').textContent = count4G;
            document.getElementById('5gCount').textContent = count5G;
            document.getElementById('totalCount').textContent = totalCount;
        }

        function updateSignal() {
            let best4G = 0, best5G = 0;

            stations.forEach(station => {
                const dx = userX - station.x;
                const dy = userY - station.y;
                const distance = Math.sqrt(dx*dx + dy*dy);

                if(station.type === 'dual') {
                    best4G = Math.max(best4G, SIGNAL['4G'].max * Math.max(0, 1 - (distance/SIGNAL['4G'].range)**2));
                    best5G = Math.max(best5G, SIGNAL['5G'].max * Math.max(0, 1 - (distance/SIGNAL['5G'].range)**2));
                }
                else if(station.type === '4G') {
                    best4G = Math.max(best4G, SIGNAL['4G'].max * Math.max(0, 1 - (distance/SIGNAL['4G'].range)**2));
                }
                else if(station.type === '5G') {
                    best5G = Math.max(best5G, SIGNAL['5G'].max * Math.max(0, 1 - (distance/SIGNAL['5G'].range)**2));
                }
            });

            const final4G = Math.round(best4G);
            const final5G = Math.round(best5G);
            const maxSignal = Math.max(final4G, final5G);

            // æ›´æ–°æ˜¾ç¤º
            document.getElementById('4g').textContent = final4G;
            document.getElementById('5g').textContent = final5G;

            // æ›´æ–°ä¿¡å·æ¡
            document.getElementById('signalBar').style.background = 
                `linear-gradient(90deg, 
                 #e74c3c ${maxSignal/10}%,
                 #f1c40f ${maxSignal/2}%, 
                 #2ecc71 ${maxSignal}%)`;

            // æ›´æ–°éŸ³é‡ï¼ˆä¿¡å·ä¸º0æ—¶é™éŸ³ï¼‰
            if(isAudioEnabled) {
                const volumeScale = maxSignal > 0 ? Math.min(1, maxSignal / 1000) : 0;
                bgm.volume = BASE_VOLUME * volumeScale;
            }
        }

        function toggleAudio() {
            isAudioEnabled = !isAudioEnabled;
            document.getElementById('musicControl').textContent = `ğŸµ ${isAudioEnabled ? 'å…³é—­' : 'å¼€å¯'}éŸ³æ•ˆ`;
            
            if(isAudioEnabled) {
                bgm.play().catch(() => {
                    alert("è¯·å…ˆç‚¹å‡»é¡µé¢ä»»æ„ä½ç½®æ¿€æ´»éŸ³é¢‘");
                    isAudioEnabled = false;
                });
            } else {
                bgm.pause();
            }
        }

        // ç”¨æˆ·æ§åˆ¶
        document.addEventListener('keydown', (e) => {
            const speed = 8;
            const boundCheck = (value, max) => Math.max(20, Math.min(max - 20, value));
            
            switch(e.key) {
                case 'ArrowUp': userY = boundCheck(userY - speed, 700); break; // è°ƒæ•´è¾¹ç•Œæ£€æŸ¥
                case 'ArrowDown': userY = boundCheck(userY + speed, 700); break; // è°ƒæ•´è¾¹ç•Œæ£€æŸ¥
                case 'ArrowLeft': userX = boundCheck(userX - speed, 1000); break; // è°ƒæ•´è¾¹ç•Œæ£€æŸ¥
                case 'ArrowRight': userX = boundCheck(userX + speed, 1000); break; // è°ƒæ•´è¾¹ç•Œæ£€æŸ¥
            }
            updateUserPosition();
            updateSignal();
        });

        document.getElementById('add4G').addEventListener('click', () => createStation('4G'));
        document.getElementById('add5G').addEventListener('click', () => createStation('5G'));

        // é‡ç½®åŠŸèƒ½
        document.getElementById('resetButton').addEventListener('click', () => {
            // æ¸…ç©ºç”»å¸ƒä¸­çš„æ‰€æœ‰åŸºç«™
            const baseStations = document.querySelectorAll('.base-station');
            const labels = document.querySelectorAll('.station-label');
            baseStations.forEach(station => station.remove());
            labels.forEach(label => label.remove());

            // æ¢å¤åˆå§‹çŠ¶æ€
            stations = [{x: 500, y: 350, type: 'dual'}];
            userX = 500;
            userY = 350;
            updateUserPosition();

            // åˆ›å»ºåˆå§‹åŒæ¨¡åŸºç«™
            const initialStation = document.createElement('div');
            initialStation.className = 'base-station';
            initialStation.style.left = '500px';
            initialStation.style.top = '350px';
            initialStation.innerHTML = 'ğŸ“¡';
            canvas.appendChild(initialStation);

            const initialLabel = document.createElement('div');
            initialLabel.className = 'station-label';
            initialLabel.textContent = 'åŒæ¨¡åŸºç«™';
            initialLabel.style.left = '500px';
            initialLabel.style.top = '390px';
            canvas.appendChild(initialLabel);

            updateCounter();
            updateSignal();
        });

        // éŸ³é¢‘åˆå§‹åŒ–
        document.addEventListener('click', () => {
            bgm.play().then(() => {
                isAudioEnabled = true;
                document.getElementById('musicControl').textContent = 'ğŸµ å…³é—­éŸ³æ•ˆ';
            }).catch(() => {});
        }, { once: true });

        // åˆå§‹æ›´æ–°
        updateCounter();
        updateSignal();
    </script>
</body>
</html>